<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-8 max-w-4xl">
        <h1 class="text-4xl font-bold mb-6 text-center text-gray-900">User Management System</h1>

        <!-- Form to Add a New User -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h2 class="text-2xl font-semibold mb-4">Add a New User</h2>
            <form id="addUserForm" class="space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="name" name="name" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="email" name="email" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <button type="submit" class="w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Add User
                </button>
            </form>
            <div id="formMessage" class="mt-4 text-center"></div>
        </div>

        <!-- Display Users -->
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Current Users</h2>
            <button id="loadUsersBtn" class="mb-4 py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700">
                Load Users
            </button>
            <div id="userList" class="space-y-3">
                <!-- Users will be loaded here -->
                <p class="text-gray-500">Click "Load Users" to see the list.</p>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        // This is the URL of your .NET backend API.
        // In a real project, this would point to your deployed API.
        const apiUrl = 'https://api.example.com/users'; 

        // --- DOM Elements ---
        const addUserForm = document.getElementById('addUserForm');
        const loadUsersBtn = document.getElementById('loadUsersBtn');
        const userList = document.getElementById('userList');
        const formMessage = document.getElementById('formMessage');

        // --- Event Listeners ---

        // Event listener for the "Add User" form submission
        addUserForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // Prevent default form submission
            
            const name = event.target.name.value;
            const email = event.target.email.value;
            
            // Basic validation
            if (!name || !email) {
                showMessage('Name and email are required.', 'red');
                return;
            }

            const newUser = { name, email };

            try {
                // Use the fetch API to send a POST request to the backend
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(newUser),
                });

                if (!response.ok) {
                    // Handle HTTP errors like 404 or 500
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                showMessage('User added successfully!', 'green');
                addUserForm.reset();
                loadUsers(); // Refresh the user list

            } catch (error) {
                console.error('Error adding user:', error);
                // In a real app, you wouldn't expose the API URL in the error message
                showMessage(`Error: Could not add user. Is the backend running at ${apiUrl}?`, 'red');
            }
        });

        // Event listener for the "Load Users" button
        loadUsersBtn.addEventListener('click', loadUsers);

        // --- Functions ---

        /**
         * Fetches users from the API and displays them.
         */
        async function loadUsers() {
            userList.innerHTML = '<p class="text-gray-500">Loading...</p>'; // Show loading indicator
            try {
                // Use the fetch API to send a GET request
                const response = await fetch(apiUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const users = await response.json();
                displayUsers(users);

            } catch (error) {
                console.error('Error fetching users:', error);
                userList.innerHTML = `<p class="text-red-500">Error fetching users. Could not connect to the backend.</p>`;
            }
        }

        /**
         * Renders the list of users in the DOM.
         * @param {Array} users - An array of user objects.
         */
        function displayUsers(users) {
            userList.innerHTML = ''; // Clear current list
            if (users.length === 0) {
                userList.innerHTML = '<p class="text-gray-500">No users found.</p>';
                return;
            }

            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'p-3 bg-gray-50 border rounded-md flex justify-between items-center';
                userDiv.innerHTML = `
                    <div>
                        <p class="font-semibold">${user.name}</p>
                        <p class="text-sm text-gray-600">${user.email}</p>
                    </div>
                `;
                userList.appendChild(userDiv);
            });
        }

        /**
         * Displays a status message in the form area.
         * @param {string} message - The message to display.
         * @param {string} color - The color of the message text (e.g., 'green' or 'red').
         */
        function showMessage(message, color) {
            formMessage.textContent = message;
            formMessage.className = `mt-4 text-center text-${color}-600`;
            setTimeout(() => {
                formMessage.textContent = '';
            }, 3000); // Message disappears after 3 seconds
        }

    </script>
</body>
</html>
